<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Sprockets::UnloadedAsset - sprockets-3.7.1 Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">Object
  
</div>

    
    
    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-new">::new</a>
    
    <li ><a href="#method-i-asset_key">#asset_key</a>
    
    <li ><a href="#method-i-dependency_history_key">#dependency_history_key</a>
    
    <li ><a href="#method-i-digest_key">#digest_key</a>
    
    <li ><a href="#method-i-file_digest_key">#file_digest_key</a>
    
    <li ><a href="#method-i-filename">#filename</a>
    
    <li ><a href="#method-i-load_file_params">#load_file_params</a>
    
    <li ><a href="#method-i-params">#params</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Sprockets::UnloadedAsset">
  <h1 id="class-Sprockets::UnloadedAsset" class="class">
    class Sprockets::UnloadedAsset
  </h1>

  <section class="description">
    
<p>Internal: Used to parse and store the URI to an unloaded asset Generates
keys used to store and retrieve items from cache</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-compressed_path" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">compressed_path</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
      <div id="attribute-i-uri" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">uri</span><span
            class="attribute-access-type">[R]</span>
        </div>

        <div class="method-description">
        
        
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(uri, env)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Initialize object for generating cache keys</p>

<p>uri - A String containing complete URI to a file including scheme</p>

<pre>and full path such as
&quot;file:///Path/app/assets/js/app.js?type=application/javascript&quot;</pre>

<p>env - The current “environment” that assets are being loaded into.</p>

<pre>We need it so we know where the +root+ (directory where sprockets
is being invoked). We also need for the `file_digest` method,
since, for some strange reason, memoization is provided by
overriding methods such as `stat` in the `PathUtils` module.</pre>

<p>Returns <a href="UnloadedAsset.html">UnloadedAsset</a>.</p>
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>)
  <span class="ruby-ivar">@uri</span>               = <span class="ruby-identifier">uri</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@env</span>               = <span class="ruby-identifier">env</span>
  <span class="ruby-ivar">@compressed_path</span>   = <span class="ruby-constant">URITar</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">uri</span>, <span class="ruby-identifier">env</span>).<span class="ruby-identifier">compressed_path</span>
  <span class="ruby-ivar">@params</span>            = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># lazy loaded</span>
  <span class="ruby-ivar">@filename</span>          = <span class="ruby-keyword">nil</span> <span class="ruby-comment"># lazy loaded</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-asset_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">asset_key</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Key of asset</p>

<p>Used to retrieve an asset from the cache based on “compressed” path to
asset. A “compressed” path can either be relative to the root of the
project or an absolute path.</p>

<p>Returns a String.</p>
          
          

          
          <div class="method-source-code" id="asset_key-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 76</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">asset_key</span>
  <span class="ruby-node">&quot;asset-uri:#{compressed_path}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-dependency_history_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">dependency_history_key</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Public: Dependency History key</p>

<p>Used to retrieve an array of “histories” each of which contain a set of
stored dependencies for a given asset path and filename digest.</p>

<p>A dependency can refer to either an asset i.e. index.js may rely on
jquery.js (so jquery.js is a dependency), or other factors that may affect
compilation, such as the VERSION of sprockets (i.e. the environment) and
what “processors” are used.</p>

<p>For example a history array with one Set of dependencies may look like:</p>

<p>[[“environment-version”, “environment-paths”,
“processors:type=text/css&amp;file_type=text/css”,</p>

<pre>&quot;file-digest:///Full/path/app/assets/stylesheets/application.css&quot;,
&quot;processors:type=text/css&amp;file_type=text/css&amp;pipeline=self&quot;,
&quot;file-digest:///Full/path/app/assets/stylesheets&quot;]]</pre>

<p>This method of asset lookup is used to ensure that none of the dependencies
have been modified since last lookup. If one of them has, the key will be
different and a new entry must be stored.</p>

<p>URI depndencies are later converted to “compressed” paths</p>

<p>Returns a String.</p>
          
          

          
          <div class="method-source-code" id="dependency_history_key-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 103</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">dependency_history_key</span>
  <span class="ruby-node">&quot;asset-uri-cache-dependencies:#{compressed_path}:#{ @env.file_digest(filename) }&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-digest_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">digest_key</span><span
            class="method-args">(digest)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: <a href="Digest.html">Digest</a> key</p>

<p>Used to retrieve a string containing the “compressed” path to an asset
based on a digest. The digest is generated from dependencies stored via
information stored in the `dependency_history_key` after each of the
“dependencies” is “resolved” for example “environment-version” may be
resolved to “environment-1.0-3.2.0” for version “3.2.0” of sprockets</p>

<p>Returns a String.</p>
          
          

          
          <div class="method-source-code" id="digest_key-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">digest_key</span>(<span class="ruby-identifier">digest</span>)
  <span class="ruby-node">&quot;asset-uri-digest:#{compressed_path}:#{digest}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-file_digest_key" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">file_digest_key</span><span
            class="method-args">(stat)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: File digest key</p>

<p>The digest for a given file won&#39;t change if the path and the stat time
hasn&#39;t changed We can save time by not re-computing this information
and storing it in the cache</p>

<p>Returns a String.</p>
          
          

          
          <div class="method-source-code" id="file_digest_key-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 125</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">file_digest_key</span>(<span class="ruby-identifier">stat</span>)
  <span class="ruby-node">&quot;file_digest:#{compressed_path}:#{stat}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-filename" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filename</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Full file path without schema</p>

<p>This returns a string containing the full path to the asset without the
schema. Information is loaded lazilly since we want `UnloadedAsset.new(dep,
self).relative_path` to be fast. Calling this method the first time
allocates an array and a hash.</p>

<p>Example</p>

<p>If the URI is `file:///Full/path/app/assets/javascripts/application.js“`
then the filename would be
`”/Full/path/app/assets/javascripts/application.js“`</p>

<p>Returns a String.</p>
          
          

          
          <div class="method-source-code" id="filename-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 42</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filename</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@filename</span>
    <span class="ruby-identifier">load_file_params</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@filename</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">params</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Hash of param values</p>

<p>This information is generated and used internally by sprockets. Known keys
include `:type` which store the asset&#39;s mime-type, `:id` which is a
fully resolved digest for the asset (includes dependency digest as opposed
to a digest of only file contents) and `:pipeline`. Hash may be empty.</p>

<p>Example</p>

<p>If the URI is
`file:///Full/path/app/assets/javascripts/application.js“type=application/javascript`
Then the params would be `{type: ”application/javascript“}`</p>

<p>Returns a Hash.</p>
          
          

          
          <div class="method-source-code" id="params-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">params</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@params</span>
    <span class="ruby-identifier">load_file_params</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@params</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="private-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Private Instance Methods</h3>
       </header>

    
      <div id="method-i-load_file_params" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">load_file_params</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Internal: Parses uri into filename and params hash</p>

<p>Returns Array with filename and params hash</p>
          
          

          
          <div class="method-source-code" id="load_file_params-source">
            <pre><span class="ruby-comment"># File lib/sprockets/unloaded_asset.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">load_file_params</span>
  <span class="ruby-ivar">@filename</span>, <span class="ruby-ivar">@params</span> = <span class="ruby-constant">URIUtils</span>.<span class="ruby-identifier">parse_asset_uri</span>(<span class="ruby-identifier">uri</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://rdoc.github.io/rdoc">RDoc</a> 5.0.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

